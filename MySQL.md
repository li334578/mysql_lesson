# MySQL

## 1.1为什么学习MySQL

- 岗位需求

- 大数据时代

- 存数据

- 数据库是所有软件体系中最核心的存在

## 1.2什么是数据库

数据库(DB、DataBase)

概念：数据仓库，软件，安装在操作系统(windows,linux,mac os)之上。SQL，存储大量的数据。500w

左右：存储数据、管理数据

## 1.3数据库分类

- (SQL)关系型：MySQL、Oracle、SQL Server、DB2、SQL lite

- 通过表与表之间，行与列之间的关系进行数据存储，

- (NoSQL not only)非关系型

- Redis、MONGODB

对象存储，通过对象自身的属性来决定

DBMS 数据库管理系统

数据库管理软件，科学有效的管理数据

## 1.4MySQL简介

关系型数据库管理系统

MySQL、开源的关系型数据库系统

体积小、速度快

5.7稳定

8.0

## 1.5MySQL安装

## 2操作数据库

## 2.1数据库的列类型

| 类型      | 备注                     | 数据长度 |
| --------- | ------------------------ | -------- |
| tinyint   | 十分小的数据             | 1字节    |
| smallint  | 较小的数据               | 2字节    |
| mediumint | 中等大小的数据           | 3字节    |
| int       | 标准的数据               | 4字节    |
| bigint    | 较大的数据               | 8字节    |
| float     | 浮点数                   | 4字节    |
| double    | 浮点数                   | 8字节    |
| decimal   | 字符串形式的浮点数(精度) | 8字节    |
| char      | 固定大小的字符串         | 0-255    |
| varchar   | 可变长的字符串           | 0-65535  |
| tinytext  | 微型文本                 | 2^8-1    |
| text      | 大文本                   | 2^16-1   |
| date      | YYYY-MM-DD               |          |
| time      | HH:mm:ss                 |          |
| datetime  | YYYY-MM-DD HH:mm:ss                |          |
| timeStamp | 时间戳 1970.1.1到现在的毫秒数 |          |
| year | 年份表示 |          |
| null | 没有值，不要使用null进行运算 |          |

## 2.2数据库的字段属性

unsigned：无符号数(声明该列不能为负数)

zerofill:零填充(不足的位数使用0填充)

自增:自动在上一条记录的基础上+1(默认),通常用来设计数据表的唯一主键~index，必须是整数类型。可自定义起始值和步长。

非空：not null 不能为空，不赋值的情况下会报错。

默认：不填写值会默认填充。

## 2.3数据库设计必须要有的字段

主键

version 乐观锁

is_delete 伪删除

gmt_create 创建时间

gmt_update 修改时间

int(M)数据库中M指示最大显示宽度，最大有效显示宽度是255。显示宽度和存储大小或类型包含的值的范围无关。int还是4个字节的长度占用。

## 2.4扩展

```mysql
Auto_increment 自增

comment 注释

show create Table student 查看创建数据表的语句

DESC student 显示表结构



```

## 2.5数据库引擎

- INNODB 默认使用
- MYISAM 早些年使用

|              | MYISAM | INNODB                 |
| ------------ | ------ | ---------------------- |
| 事务         | 不支持 | 支持                   |
| 数据行锁定   | 不支持 | 支持                   |
| 外键         | 不支持 | 支持                   |
| 全文索引     | 支持   | 不支持                 |
| 表空间的大小 | 较小   | 较大，约为MYISAM的两倍 |

常规使用操作

+ MYISAM 节约空间，速度较快

+ INNODB 安全性高，事务的处理,多表多用户操作

  >  物理空间

数据库的data目录下,一个文件夹就对应一个数据库。

- INNODB 在数据库中 *.frm文件，以及上级目录下的ibdata1

- MYISAM 对应的文件 

- *.frm表结构

- *.MYD 数据文件

- *.MYI 索引文件

  设置数据库表的字符集编码`CHARSET=utf8` MySQL默认编码是Latin1，不支持中文。

# 数据库查询语句

## 4.1查询所有信息

```mysql
select * from user;
-- 查询指定的字段
select name from user;
-- 别名
select name As 名字 user;
select name As 名字 user As 用户表
-- 函数 Concat
select CONCAT("姓名:",name) As 新名字 from user;
```

> 有时候数据库列名不能直观的表达含义，可以使用as取别名

- 去重 distinct 查询结果中重复的数据只显示一条

```mysql
select version();
select 100*3-1 as 计算结果;
select @@auto_increment_increment; -- 查询自增的步长
```

数据库中的表达式：文本值，列，NULL，函数，计算式，变量...

## 4.2连表查询

![七种连接查询](http://cdn.liwenbo.cool/seven_jion.jpg)

| inner join | 如果表中至少有一个匹配，就返回行           |
| ---------- | ------------------------------------------ |
| left join  | 会从左表中返回所有的值，即使右表中没有匹配 |
| right join | 会从右表中返回所有的值，即使左表中没有匹配 |

# MYSQL函数

## 5.1常用函数

```mysql
select abs(-8); -- 8 绝对值
select ceiling(9.4); -- 10 向上取整
select floor(9.4); -- 9 向下取整
select rand(); -- 随机数 [0-1)
select sign(5); -- 1 | 0->0 | -10 -> -1 | 10->1
-- 字符串
select char_length('嘻嘻嘻嘻嘻嘻'); -- 6 字符串长度
select concat('I','like'); -- Ilike 拼接字符串
select insert('我爱编程helloworld',1,2,'超级热爱'); -- 超级热爱编程helloworld
-- insert(str,pos,len,newstr)
select upper('HelloWorld'); -- HELLOWORLD
select lower('HelloWorld'); -- helloworld
select inster('helloworld','e'); -- 2
```

## 5.2聚合函数

| 函数名称 | 描述   |
| -------- | ------ |
| COUNT()  | 计数   |
| SUM()    | 求和   |
| AVG()    | 平均值 |
| MAX()    | 最大值 |
| MIN()    | 最小值 |

- count
  * count(指定列) 会忽略null值
  * count(*) 不会忽略null值 计算行数
  * count(1) 不会忽略null值 计算行数

```mysql
group by 通过什么字段来分组
having 分组之后的过滤条件
```

# 6事务

一组要么都成功，要么都失败的操作。

## 6.1事务的原则

ACID

原子性、一致性、隔离性、持久性

- 原子性是指一个事务是一个不可分割的工作单位，其中的操作要么都做，要么都不做；

-  一致性是指事务执行前后，数据处于一种合法的状态，这种状态是语义上的而不是语法上的。 这个状态是满足预定的约束就叫做合法的状态，再通俗一点，这状态是由你自己来定义的。满足这个状态，数据就是一致的，不满足这个状态，数据就是不一致的！
- 持久性是指事务一旦提交，它对数据库的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。
- **与原子性、持久性侧重于研究事务本身不同，隔离性研究的是不同事务之间的相互影响。**隔离性是指，事务内部的操作与其他事务是隔离的，并发执行的各个事务之间不能互相干扰。严格的隔离性，对应了事务隔离级别中的Serializable (可串行化)，但实际应用中出于性能方面的考虑很少会使用可串行化。

脏读、幻读、不可重复读

- 脏读：(**针对未提交的数据**)一个事务在更新一条记录，未提交前，第二个事务读到了第一个事务更新后的记录，那么第二个事务就读到了脏数据，会产生对第一个未提交数据的依赖。一旦第一个事务回滚，那么第二个事务读到的数据，将是错误的脏数据。
- 不可重复读：（**读取数据本身的对比**）一个事务在读取某些数据后的一段时间后，再次读取这个数据，发现其读取出来的数据内容已经发生了改变，就是不可重复读。
- 幻读：（**读取结果集条数的对比**）一个事务按相同的查询条件查询之前检索过的数据，确发现检索出来的结果集条数变多或者减少（由其他事务插入、删除的），类似产生幻觉。

## 7索引

## 7.1索引的分类

索引(key)是存储引擎用于快速找到记录的一种数据结构。它和一本书中目录的工作方式类似——当要查找一行记录时，先在索引中快速找到行所在的位置信息，然后再直接获取到那行记录。
在MySql中，索引是在存储引擎层而不是服务器层实现的，所以不同的存储引擎对索引的实现和支持都不相同。

- 主键索引 PRIMARY KEY
  * 唯一的标识，主键不可重复
- 唯一索引 UNIQUE KEY
  * 避免重复的列，可以重复，多个列都可以标识为重复索引
- 常规索引 index
  - 默认索引 index key来设置
- 全文索引 FullText
  - 在特定的数据库引擎下才有。MyIASM。
  - 快速定位数据

EXPLAIN分析SQL执行情况